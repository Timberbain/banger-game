---
phase: 10-powerup-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/scenes/BootScene.ts
  - client/src/config/SoundDefs.ts
  - client/src/systems/ParticleFactory.ts
autonomous: true

must_haves:
  truths:
    - "Potion icon sprites (blue, orange, red) are preloaded and available as textures in all scenes"
    - "Powerup SFX (pickup, spawn, despawn) are generated via jsfxr and playable through AudioManager"
    - "ParticleFactory provides continuous aura emitter methods for speed (blue), invincibility (gold), and projectile (red) buffs"
  artifacts:
    - path: "client/src/scenes/BootScene.ts"
      provides: "Preloaded potion icon textures: potion_speed, potion_invincibility, potion_projectile"
      contains: "potion_speed"
    - path: "client/src/config/SoundDefs.ts"
      provides: "SFX definitions for powerup_pickup, powerup_spawn, powerup_despawn"
      contains: "powerup_pickup"
    - path: "client/src/systems/ParticleFactory.ts"
      provides: "speedAura, invincibilityAura, projectileAura methods returning ParticleEmitters"
      contains: "speedAura"
  key_links:
    - from: "client/src/scenes/BootScene.ts"
      to: "client/public/icons/"
      via: "this.load.image preload calls"
      pattern: "load\\.image.*potion"
    - from: "client/src/config/SoundDefs.ts"
      to: "client/src/systems/AudioManager.ts"
      via: "SOUND_DEFS export consumed by AudioManager.init()"
      pattern: "powerup_pickup"
---

<objective>
Prepare all client-side assets, sound effects, and particle effect methods needed by the powerup system rendering.

Purpose: Decouple asset preparation from the rendering integration. After this plan, all textures, SFX, and particle factories are ready for GameScene and HUDScene to consume without any loading delays.

Output: Modified `BootScene.ts` with potion texture preloads, `SoundDefs.ts` with 3 new SFX, and `ParticleFactory.ts` with 3 new aura emitter methods.
</objective>

<execution_context>
@/Users/jonasbrandvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jonasbrandvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-powerup-system/10-RESEARCH.md
@client/src/scenes/BootScene.ts
@client/src/config/SoundDefs.ts
@client/src/systems/ParticleFactory.ts
@assets/icons/icon-map.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Preload potion sprites and copy icon assets to public directory</name>
  <files>
    client/src/scenes/BootScene.ts
  </files>
  <action>
**1. Copy potion icon PNGs** from `assets/icons/` to `client/public/icons/` (create the `icons/` directory under `client/public/` if it doesn't exist):
- `assets/icons/icon280.png` -> `client/public/icons/potion-blue.png` (Speed Boost)
- `assets/icons/icon279.png` -> `client/public/icons/potion-orange.png` (Invincibility)
- `assets/icons/icon277.png` -> `client/public/icons/potion-red.png` (Power Shot / Projectile)

These are 16x16 pixel art potion bottles already in the correct format.

**2. Modify `BootScene.ts` preload():**
After the existing image preloads (after the `victory-paran` line), add:
```typescript
// Powerup potion sprites (16x16 pixel art icons)
this.load.image('potion_speed', 'icons/potion-blue.png');
this.load.image('potion_invincibility', 'icons/potion-orange.png');
this.load.image('potion_projectile', 'icons/potion-red.png');
```

These texture keys (`potion_speed`, `potion_invincibility`, `potion_projectile`) will be referenced by GameScene for rendering powerup items on the ground.
  </action>
  <verify>
Verify icon files exist at `client/public/icons/potion-blue.png`, `client/public/icons/potion-orange.png`, `client/public/icons/potion-red.png`. Verify BootScene.ts contains all three `this.load.image('potion_...')` calls.
  </verify>
  <done>Potion icon sprites are copied to public directory and preloaded in BootScene. Textures `potion_speed`, `potion_invincibility`, `potion_projectile` are available for all scenes.</done>
</task>

<task type="auto">
  <name>Task 2: Add powerup SFX definitions and ParticleFactory aura methods</name>
  <files>
    client/src/config/SoundDefs.ts
    client/src/systems/ParticleFactory.ts
  </files>
  <action>
**1. Add SFX to `SoundDefs.ts`:**

Add a new section after the UI SOUNDS section (before the EXPORT section):

```typescript
// ============================================================
// POWERUP SOUNDS
// ============================================================

// Powerup pickup: Ascending chime -- sine wave, arpeggio, rewarding feel
const powerup_pickup = defaults({
  wave_type: 2, // sine
  p_env_attack: 0,
  p_env_sustain: 0.1,
  p_env_punch: 0.3,
  p_env_decay: 0.3,
  p_base_freq: 0.45,
  p_freq_ramp: 0.2,
  p_arp_mod: 0.5,
  p_arp_speed: 0.4,
  sound_vol: 0.3,
});

// Powerup spawn: Soft ambient notification -- sine wave, slight reverb
const powerup_spawn = defaults({
  wave_type: 2, // sine
  p_env_attack: 0.05,
  p_env_sustain: 0.08,
  p_env_punch: 0.1,
  p_env_decay: 0.2,
  p_base_freq: 0.55,
  p_freq_ramp: -0.1,
  sound_vol: 0.2,
});

// Powerup despawn: Short disappearance whoosh -- noise, downward frequency
const powerup_despawn = defaults({
  wave_type: 3, // noise
  p_env_attack: 0,
  p_env_sustain: 0.05,
  p_env_punch: 0.2,
  p_env_decay: 0.15,
  p_base_freq: 0.3,
  p_freq_ramp: -0.3,
  sound_vol: 0.15,
});
```

Add the three new entries to the `SOUND_DEFS` export object:
```typescript
// Powerups
powerup_pickup,
powerup_spawn,
powerup_despawn,
```

**2. Add aura methods to `ParticleFactory.ts`:**

Add three new methods that return continuous ParticleEmitter instances for buff aura effects. These follow a sprite and emit continuously until destroyed by the caller. Each returns the emitter so the caller can track and destroy it.

**`speedAura(followTarget)`:**
- Blue-cyan particles (`0x4488FF`)
- Fast outward radial burst suggesting velocity/motion
- Config: `frequency: 50, lifespan: 400, speed: { min: 20, max: 60 }, scale: { start: 0.6, end: 0 }, alpha: { start: 0.5, end: 0 }, tint: 0x4488FF, angle: { min: 0, max: 360 }, follow: followTarget, emitting: true`
- Set depth to 9 (below player sprites at 10, above trails)
- Add to `this.activeTrails` for cleanup tracking

**`invincibilityAura(followTarget)`:**
- Gold-amber particles (`0xFFCC00`)
- Orbiting/shield-like pattern, larger scale
- Config: `frequency: 40, lifespan: 500, speed: { min: 30, max: 50 }, scale: { start: 0.8, end: 0 }, alpha: { start: 0.6, end: 0 }, tint: 0xFFCC00, angle: { min: 0, max: 360 }, follow: followTarget, emitting: true`
- Set depth to 9
- Add to `this.activeTrails`

**`projectileAura(followTarget)`:**
- Red-orange spark particles (`0xFF4422`)
- Spark-like with slight gravity, suggesting power/energy
- Config: `frequency: 60, lifespan: 350, speed: { min: 15, max: 45 }, scale: { start: 0.5, end: 0 }, alpha: { start: 0.6, end: 0 }, tint: 0xFF4422, gravityY: 30, angle: { min: 0, max: 360 }, follow: followTarget, emitting: true`
- Set depth to 9
- Add to `this.activeTrails`

All three methods have the same signature:
```typescript
methodName(followTarget: Phaser.GameObjects.Sprite): Phaser.GameObjects.Particles.ParticleEmitter
```

They return the emitter so GameScene can track it per-player and destroy it when the buff expires. The `activeTrails` tracking ensures cleanup in `destroy()`.
  </action>
  <verify>
Run `cd /Users/jonasbrandvik/Projects/banger-game/client && npx tsc --noEmit` to confirm no TypeScript errors. Verify `SOUND_DEFS` object contains keys `powerup_pickup`, `powerup_spawn`, `powerup_despawn`. Verify `ParticleFactory` has methods `speedAura`, `invincibilityAura`, `projectileAura` all returning `ParticleEmitter`.
  </verify>
  <done>Three powerup SFX are defined in SoundDefs and will be auto-generated by AudioManager on boot. Three aura particle emitter methods exist on ParticleFactory with distinct visual styles per buff type (blue/gold/red). All textures, sounds, and effects are ready for integration.</done>
</task>

</tasks>

<verification>
1. `cd client && npx tsc --noEmit` passes with no errors
2. Potion icon files exist at `client/public/icons/potion-{blue,orange,red}.png`
3. BootScene preloads `potion_speed`, `potion_invincibility`, `potion_projectile` textures
4. SoundDefs exports `powerup_pickup`, `powerup_spawn`, `powerup_despawn`
5. ParticleFactory has `speedAura()`, `invincibilityAura()`, `projectileAura()` methods
6. All aura methods track emitters in `activeTrails` for cleanup
</verification>

<success_criteria>
Client compiles. All potion sprites preloaded. All SFX defined and ready for AudioManager generation. Particle aura methods available for per-buff visual effects. No existing functionality broken.
</success_criteria>

<output>
After completion, create `.planning/phases/10-powerup-system/10-02-SUMMARY.md`
</output>
