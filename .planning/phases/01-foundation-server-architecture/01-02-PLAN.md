---
phase: 01-foundation-server-architecture
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - client/package.json
  - client/tsconfig.json
  - client/vite.config.ts
  - client/index.html
  - client/src/main.ts
  - client/src/scenes/BootScene.ts
  - client/public/maps/test_arena.json
  - client/public/tilesets/placeholder.png
autonomous: true

must_haves:
  truths:
    - "Browser opens at localhost:8080 and displays Phaser game canvas"
    - "A test tilemap renders in the Phaser scene with visible ground and wall tiles"
    - "Tiled-compatible JSON map format is used (uncompressed CSV layers)"
    - "Wall tiles have collision property set for future physics use"
  artifacts:
    - path: "client/package.json"
      provides: "Client dependencies (phaser, colyseus.js, vite)"
      contains: "phaser"
    - path: "client/vite.config.ts"
      provides: "Vite dev server config on port 8080"
      contains: "8080"
    - path: "client/src/main.ts"
      provides: "Phaser game configuration and entry point"
      contains: "Phaser.Game"
    - path: "client/src/scenes/BootScene.ts"
      provides: "Boot scene that loads tilemap and renders arena"
      contains: "tilemapTiledJSON"
    - path: "client/public/maps/test_arena.json"
      provides: "Tiled-compatible JSON tilemap (test arena)"
      contains: "tiledversion"
    - path: "client/public/tilesets/placeholder.png"
      provides: "Placeholder tileset image for map rendering"
  key_links:
    - from: "client/src/main.ts"
      to: "client/src/scenes/BootScene.ts"
      via: "Phaser scene configuration"
      pattern: "BootScene"
    - from: "client/src/scenes/BootScene.ts"
      to: "client/public/maps/test_arena.json"
      via: "this.load.tilemapTiledJSON"
      pattern: "tilemapTiledJSON.*test_arena"
---

<objective>
Set up the Phaser 3 client project with Vite bundler and create a test arena tilemap that renders in the browser.

Purpose: The client is the player-facing rendering layer. It will only render server-authoritative state (no client-side game logic). This plan establishes the project structure, Phaser configuration, and a working Tiled-compatible map that proves the MAP-02 requirement (Tiled tilemap format).

Output: A browser-accessible Phaser game at localhost:8080 that renders a test arena tilemap with ground and wall layers.
</objective>

<execution_context>
@/Users/jonasbrandvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jonasbrandvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-server-architecture/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create client project with Vite + Phaser + TypeScript</name>
  <files>
    client/package.json
    client/tsconfig.json
    client/vite.config.ts
    client/index.html
    client/src/main.ts
  </files>
  <action>
    Create the client/ directory and set up the Phaser 3 project manually with Vite (do NOT clone the Phaser template -- we need precise control).

    **client/package.json:**
    - name: "banger-client"
    - dependencies: phaser@^3.90, colyseus.js@^0.17
    - devDependencies: typescript@^5, vite@^5, @types/node
    - scripts: "dev" = "vite", "build" = "vite build", "preview" = "vite preview"

    **client/tsconfig.json:**
    - target: "ESNext", module: "ESNext", moduleResolution: "bundler"
    - strict: true, esModuleInterop: true, skipLibCheck: true
    - include: ["src/**/*"]

    **client/vite.config.ts:**
    - Server port: 8080
    - Build rollupOptions: manualChunks with phaser in its own chunk (keeps bundle size manageable)
    - Define `process.env` as {} to avoid Node.js reference errors in browser

    **client/index.html:**
    - Minimal HTML5 document with a div#game-container
    - Script tag pointing to /src/main.ts (Vite handles TypeScript)
    - Style: body margin 0, overflow hidden, background black
    - Title: "Banger"

    **client/src/main.ts:**
    - Import Phaser
    - Import BootScene
    - Create Phaser.Game config:
      - type: Phaser.AUTO (prefers WebGL, falls back to Canvas)
      - width: 800, height: 600
      - parent: "game-container"
      - backgroundColor: "#1a1a2e" (dark background)
      - scene: [BootScene]
      - physics: { default: 'arcade', arcade: { debug: false } } (Phaser physics for future collision, not for game logic -- that's server-side)
      - scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH }

    Run `cd client && npm install` after creating files.
  </action>
  <verify>
    Run `cd client && npx tsc --noEmit` -- should compile with zero errors (once BootScene exists from Task 2).
    Run `cd client && npm run dev` -- Vite dev server starts on port 8080.
  </verify>
  <done>Client project exists with Phaser + Colyseus.js + Vite installed, TypeScript configured, HTML entry point ready.</done>
</task>

<task type="auto">
  <name>Task 2: Create test arena tilemap and BootScene that renders it</name>
  <files>
    client/public/maps/test_arena.json
    client/public/tilesets/placeholder.png
    client/src/scenes/BootScene.ts
  </files>
  <action>
    Create a Tiled-compatible JSON tilemap by hand (no need for the Tiled editor -- the JSON format is well-defined) and a placeholder tileset, then create the BootScene that loads and renders it.

    **client/public/tilesets/placeholder.png:**
    Generate a simple 128x64 pixel PNG programmatically (or create a minimal valid PNG). It should be a 4x2 grid of 32x32 tiles:
    - Tile 0: Empty/transparent
    - Tile 1: Dark green (ground)
    - Tile 2: Gray (wall)
    - Tiles 3-7: Variations (slightly different shades of green/gray)

    Use a canvas-based approach or create the PNG with a Node script. If that is too complex, create a minimal solid-color PNG and use Phaser's built-in graphics for visible tiles. The simplest approach: generate a small PNG using a quick Node script with the `canvas` package, OR create a minimal valid PNG file manually (a 128x64 solid image works -- the tilemap will still render with colored rectangles from the tileset).

    SIMPLEST APPROACH: Write a small Node.js script (client/scripts/generate-placeholder-tileset.js) that creates a valid PNG with colored tile squares using only built-in modules or the `sharp` package. Alternatively, if creating a PNG is too complex without dependencies, create a 1x1 white pixel PNG as a minimal placeholder and use Phaser's graphics API to draw colored rectangles for the map visualization in BootScene. Either approach is fine -- the key is having a WORKING visual map.

    **client/public/maps/test_arena.json:**
    A hand-crafted Tiled-compatible JSON tilemap representing a simple 25x19 tile arena (800x608 pixels at 32px tiles):

    ```json
    {
      "compressionlevel": -1,
      "height": 19,
      "width": 25,
      "tileheight": 32,
      "tilewidth": 32,
      "orientation": "orthogonal",
      "renderorder": "right-down",
      "tiledversion": "1.10.2",
      "type": "map",
      "version": "1.10",
      "infinite": false,
      "nextlayerid": 3,
      "nextobjectid": 1,
      "tilesets": [{
        "firstgid": 1,
        "columns": 4,
        "image": "../tilesets/placeholder.png",
        "imageheight": 64,
        "imagewidth": 128,
        "margin": 0,
        "name": "placeholder",
        "spacing": 0,
        "tilecount": 8,
        "tileheight": 32,
        "tilewidth": 32
      }],
      "layers": [
        {
          "data": [...],  // 25x19 = 475 tile IDs, all value 2 (ground tile, 1-indexed)
          "height": 19,
          "width": 25,
          "id": 1,
          "name": "Ground",
          "opacity": 1,
          "type": "tilelayer",
          "visible": true,
          "x": 0,
          "y": 0
        },
        {
          "data": [...],  // 25x19 = 475 tile IDs: walls (value 3) around perimeter, 0 for interior
          "height": 19,
          "width": 25,
          "id": 2,
          "name": "Walls",
          "opacity": 1,
          "type": "tilelayer",
          "visible": true,
          "x": 0,
          "y": 0
        }
      ]
    }
    ```

    Ground layer: All tiles = 2 (ground fill).
    Walls layer: Perimeter tiles = 3 (wall), interior = 0 (empty). Add a few interior wall clusters (3-4 small L-shaped obstacles) to make it interesting for future gameplay testing.

    IMPORTANT: Tile layer format must be CSV (flat array of integers), NOT compressed. This is the "data" array format. Tile IDs are 1-indexed (0 = no tile, 1 = first tile in tileset).

    **client/src/scenes/BootScene.ts:**
    - extends Phaser.Scene with key "BootScene"
    - preload(): Load tileset image and tilemap JSON
      ```
      this.load.image('tiles', 'tilesets/placeholder.png');
      this.load.tilemapTiledJSON('test_arena', 'maps/test_arena.json');
      ```
    - create():
      - Create tilemap: `this.make.tilemap({ key: 'test_arena' })`
      - Add tileset: `map.addTilesetImage('placeholder', 'tiles')`
      - Create ground layer: `map.createLayer('Ground', tileset, 0, 0)`
      - Create walls layer: `map.createLayer('Walls', tileset, 0, 0)`
      - Set wall collision: `wallsLayer.setCollisionByExclusion([-1, 0])` (all non-empty wall tiles collide)
      - Add a temporary text display: "Banger - Test Arena" centered at top of screen (white, 16px font)
      - Add a temporary text: "Waiting for server connection..." centered in screen
      - Log "BootScene loaded, map rendered" to console

    The scene should show a visible tilemap with ground tiles and wall border when opened in browser. Even with a simple placeholder tileset, the tile grid should be visible.
  </action>
  <verify>
    Run `cd client && npx tsc --noEmit` -- should compile with zero errors.
    Run `cd client && npm run dev` -- open http://localhost:8080 in browser, should see:
    - Phaser canvas with dark background
    - Tilemap grid visible (ground layer filled, wall border)
    - Text overlay "Banger - Test Arena" and "Waiting for server connection..."
    - Console shows "BootScene loaded, map rendered"
  </verify>
  <done>Browser at localhost:8080 shows Phaser canvas with rendered Tiled-compatible tilemap. Ground and wall layers are visible. Map JSON follows Tiled format spec with uncompressed CSV data.</done>
</task>

</tasks>

<verification>
1. `cd client && npx tsc --noEmit` compiles with zero errors
2. `cd client && npm run dev` starts Vite on port 8080
3. Browser shows Phaser game canvas with tilemap rendered
4. test_arena.json is valid Tiled-compatible JSON with uncompressed layer data
5. Wall tiles have collision configured
6. Phaser manualChunks separates phaser into its own bundle chunk
</verification>

<success_criteria>
- Client project builds and serves without errors
- Phaser game canvas renders in browser at localhost:8080
- Test arena tilemap loads and displays ground + wall layers
- Tilemap JSON is Tiled-compatible format (could be opened in Tiled editor)
- Wall layer has collision properties configured
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-server-architecture/01-02-SUMMARY.md`
</output>
