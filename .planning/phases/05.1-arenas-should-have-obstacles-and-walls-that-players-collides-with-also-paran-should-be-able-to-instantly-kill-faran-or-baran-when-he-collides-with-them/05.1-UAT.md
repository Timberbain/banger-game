---
status: diagnosed
phase: 05.1-arena-collisions-contact-kill
source: 05.1-01-SUMMARY.md, 05.1-02-SUMMARY.md, 05.1-03-SUMMARY.md
started: 2026-02-12T12:00:00Z
updated: 2026-02-12T12:10:00Z
---

## Current Test
<!-- OVERWRITE each test - shows where we are -->

[testing complete]

## Tests

### 1. Wall collision blocks movement
expected: Move any character into arena border walls. The character should stop and cannot pass through the walls. Try all four edges.
result: issue
reported: "The player stops when hitting wall, but when touching a wall and move in a different direction the collision check freaks out. For example, paran gets super speed. Also players can flicker and jitter through walls."
severity: major

### 2. Obstacle collision blocks movement
expected: Move a character into one of the colored obstacle tiles (brown/orange/gold blocks visible on the map). The character should be physically blocked and cannot walk through them.
result: issue
reported: "same issue, obstacles also cause jitter and speed glitches"
severity: major

### 3. Paran wall penalty - lose all velocity
expected: As Paran, build up speed and run into a wall or obstacle. Paran should instantly lose ALL velocity (comes to a dead stop) rather than just stopping on the colliding axis.
result: pass

### 4. Guardian wall collision - per-axis stop
expected: As a guardian (Faran/Baran), run diagonally into a wall. The guardian should stop only on the axis that hit the wall, continuing to slide along the wall on the other axis.
result: issue
reported: "works for left and top. When hitting bottom and right wall, the character jitters, get superspeed and jumps through walls"
severity: major

### 5. Paran contact kill
expected: As Paran, move into a guardian (Faran or Baran). The guardian should instantly die on body overlap. Paran keeps moving without stopping.
result: pass

### 6. Projectile-wall destruction
expected: Fire a projectile at a wall. The projectile should be destroyed on contact with the wall (disappears), dealing no damage to the wall.
result: pass

### 7. Destructible obstacle takes projectile damage
expected: Fire projectiles at a gold (Light) obstacle. After 2 hits it should be destroyed and disappear, opening the path. Orange (Medium) takes 3 hits, brown (Heavy) takes 5 hits.
result: pass

### 8. Paran instant-breaks destructible obstacles
expected: As Paran, run into any destructible obstacle (gold/orange/brown). It should instantly break regardless of its HP, opening the path. Paran loses all velocity from the collision.
result: pass

### 9. Obstacle visual tiers
expected: Three visually distinct obstacle types are visible on the maps: gold/yellow (Light), orange (Medium), and brown (Heavy). They should look clearly different from each other and from walls.
result: pass

### 10. Client prediction matches server collision
expected: Move around walls and obstacles with your local character. There should be no jitter, wall-clipping, or rubber-banding. The character should smoothly stop at obstacles without snapping.
result: issue
reported: "When colliding with a right wall and then press down, the character gets super speed downwards. If pressing up, character doesnt move"
severity: major

### 11. Destroyed obstacle syncs to all clients
expected: When an obstacle is destroyed (by projectile or Paran contact), all players should see it disappear. The tile should be removed from the map for everyone.
result: pass

### 12. Maps have strategic obstacle layouts
expected: Play on different maps (rotate by playing multiple matches). Each map should have visible destructible obstacles placed strategically in the arena, not just walls.
result: pass

## Summary

total: 12
passed: 8
issues: 4
pending: 0
skipped: 0

## Gaps

- truth: "Characters collide with walls and stop cleanly. Moving along a wall in a different direction works correctly without speed exploits or jitter."
  status: failed
  reason: "User reported: The player stops when hitting wall, but when touching a wall and move in a different direction the collision check freaks out. For example, paran gets super speed. Also players can flicker and jitter through walls."
  severity: major
  test: 1
  root_cause: "Math.floor boundary asymmetry in resolveCollisions() — right/bottom push-back places entity exactly at tile boundary, causing Math.floor to map back into the solid tile on next frame. Left/top works because push-back places entity at (tx+1)*tileSize which floors to the empty tile."
  artifacts:
    - path: "shared/collisionGrid.ts"
      issue: "Lines 139-140 (tileRight/tileBottom calc) and lines 153/185 (push-back positions) create re-collision on right/bottom edges"
  missing:
    - "Right/bottom tile range must exclude exact boundaries (subtract epsilon or use ceil-1)"
    - "Push-back for right/down should subtract epsilon to avoid landing exactly on tile boundary"
  debug_session: ".planning/debug/collision-right-bottom-wall-bug.md"

- truth: "Guardian slides along wall on non-colliding axis when hitting diagonally, all 4 edges"
  status: failed
  reason: "User reported: works for left and top. When hitting bottom and right wall, the character jitters, get superspeed and jumps through walls"
  severity: major
  test: 4
  root_cause: "Same root cause as test 1 — Math.floor boundary asymmetry in resolveCollisions(). Re-collision on right/bottom causes false hitX/hitY which incorrectly zeroes velocity."
  artifacts:
    - path: "shared/collisionGrid.ts"
      issue: "Lines 139-140, 153, 170-171, 185 — asymmetric tile boundary handling"
  missing:
    - "Fix shared in collisionGrid.ts resolves this for all collision scenarios"
  debug_session: ".planning/debug/collision-right-bottom-wall-bug.md"

- truth: "Client prediction matches server collision with no jitter, wall-clipping, or rubber-banding"
  status: failed
  reason: "User reported: When colliding with a right wall and then press down, the character gets super speed downwards. If pressing up, character doesnt move"
  severity: major
  test: 10
  root_cause: "Same root cause — floating-point divergence at exact tile boundary between client prediction and server causes reconciliation oscillation (super speed bursts). Pressing up while at right wall: false hitX triggers Paran wall penalty zeroing ALL velocity including vy."
  artifacts:
    - path: "shared/collisionGrid.ts"
      issue: "Boundary asymmetry causes false positive collision detection"
    - path: "server/src/rooms/GameRoom.ts"
      issue: "Lines 306-337 resolvePlayerCollision zeroes velocity based on false hitX/hitY"
  missing:
    - "Fix boundary calc in shared collisionGrid.ts fixes both server and client simultaneously"
  debug_session: ".planning/debug/collision-right-bottom-wall-bug.md"

- truth: "Obstacle tiles physically block characters without jitter or speed glitches"
  status: failed
  reason: "User reported: same issue, obstacles also cause jitter and speed glitches"
  severity: major
  test: 2
  root_cause: "Same root cause as test 1 — obstacle tiles use the same resolveCollisions() function with the same Math.floor boundary asymmetry on right/bottom edges."
  artifacts:
    - path: "shared/collisionGrid.ts"
      issue: "Same boundary calc bug affects all solid tiles (walls and obstacles)"
  missing:
    - "Single fix in collisionGrid.ts resolves obstacles and walls simultaneously"
  debug_session: ".planning/debug/collision-right-bottom-wall-bug.md"
