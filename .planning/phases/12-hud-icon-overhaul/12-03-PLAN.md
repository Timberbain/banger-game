---
phase: 12-hud-icon-overhaul
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/scenes/HUDScene.ts
  - client/src/systems/ParticleFactory.ts
autonomous: true
requirements: [HUD-05, HUD-06]
gap_closure: true

must_haves:
  truths:
    - "Timer, stage label, and score pips are clearly readable against any arena background"
    - "Death overlay shows only the gravestone icon without redundant ELIMINATED text"
    - "Speed aura particles are red, invincibility aura particles are blue, projectile aura particles are green"
    - "SPECTATING label does not overlap the top-center HUD cluster (timer, pips, stage label)"
  artifacts:
    - path: "client/src/scenes/HUDScene.ts"
      provides: "Top-center dark backdrop, larger timer/pips/stage label, no ELIMINATED text, repositioned spectator HUD"
      contains: "fillRoundedRect"
    - path: "client/src/systems/ParticleFactory.ts"
      provides: "Corrected aura colors matching potion colors"
      contains: "0xCC3333"
  key_links:
    - from: "client/src/systems/ParticleFactory.ts"
      to: "Potion color mapping (Red=Speed, Blue=Invincibility, Green=Projectile)"
      via: "tint values in speedAura/invincibilityAura/projectileAura"
      pattern: "speedAura.*0xCC3333|invincibilityAura.*0x4488ff|projectileAura.*0x44CC66"
---

<objective>
Fix 4 UAT gaps from Phase 12 HUD Icon Overhaul: improve top-center HUD readability (dark backdrop + larger sizes), remove redundant ELIMINATED text from death overlay, correct powerup aura colors to match potion colors, and reposition spectator label below top-center cluster.

Purpose: Address all user-reported issues from UAT testing to complete Phase 12.
Output: Patched HUDScene.ts and ParticleFactory.ts with all 4 fixes applied.
</objective>

<execution_context>
@/Users/jonasbrandvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jonasbrandvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-hud-icon-overhaul/12-UAT.md
@client/src/scenes/HUDScene.ts
@client/src/systems/ParticleFactory.ts
@client/src/ui/designTokens.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix HUDScene readability, death overlay, and spectator overlap</name>
  <files>client/src/scenes/HUDScene.ts</files>
  <action>
    Apply 4 targeted edits to HUDScene.ts:

    **1. Top-center dark backdrop + larger sizes (createMatchTimer and createRoundScore):**

    Add a new private member `topCenterBackdrop: Phaser.GameObjects.Graphics | null = null;` and reset it to null in create(). Add a new private method `createTopCenterBackdrop()` called from create() AFTER both createMatchTimer() and createRoundScore() complete. This method draws a semi-transparent dark rounded rectangle behind the top-center cluster:

    ```typescript
    private createTopCenterBackdrop(): void {
      this.topCenterBackdrop = this.add.graphics();
      this.topCenterBackdrop.setDepth(199); // Behind HUD elements at 200
      // Dark backdrop panel: covers timer area through stage label
      // Timer at H*0.03, pips at H*0.06, stage label at H*0.09
      // Width enough for timer icon + text + pips spread
      const panelW = 160;
      const panelH = 60;
      const panelX = this.W / 2 - panelW / 2;
      const panelY = this.H * 0.03 - 16; // Above timer center
      this.topCenterBackdrop.fillStyle(0x000000, 0.4);
      this.topCenterBackdrop.fillRoundedRect(panelX, panelY, panelW, panelH, 8);
    }
    ```

    Destroy `topCenterBackdrop` in onShutdown() alongside the other graphics cleanups.

    In `createMatchTimer()` (line ~366): change fontSize from `'20px'` to `'24px'`.

    In `createRoundScore()` (line ~933): change `pipRadius` from `5` to `7`. Change `pipSpacing` from `16` to `20`. Change `pipY` from `this.H * 0.07` to `this.H * 0.06` (move pips slightly up to sit better in the backdrop). In the inactive pip style (lines ~948, ~963), change alpha from `0.6` to `1.0` (change `this.roundScorePipsGfx.fillStyle(0x444444, 0.6)` to `this.roundScorePipsGfx.fillStyle(0x666666, 1.0)` -- also lighten from 0x444444 to 0x666666 for better visibility at full alpha).

    In `createRoundScore()` for the stage label (line ~898): change fontSize from `'12px'` to `'14px'`. Change color from `Colors.text.secondary` to `Colors.text.primary`. Add `strokeThickness: 3` to the text config (it already has `stroke: '#000000'` and `strokeThickness: 2` -- bump to 3).

    **2. Remove ELIMINATED text from death overlay (showDeathOverlay):**

    In `showDeathOverlay()` starting around line 1268:
    - Remove the gravestone's Y offset: change `this.H / 2 - 30` to `this.H / 2` so the gravestone is truly centered.
    - Delete the entire eliminatedText creation block (lines ~1276-1283): the `const eliminatedText = this.add.text(...)` through `eliminatedText.setAlpha(0)`.
    - Update `this.deathOverlayObjects = [gravestone, eliminatedText]` to `this.deathOverlayObjects = [gravestone]`.
    - In both tweens (fade in at line ~1288 and fade out at line ~1295), change `targets: [gravestone, eliminatedText]` to `targets: gravestone`.
    - In the fade-out onComplete, remove `eliminatedText.destroy()` -- only keep `gravestone.destroy()`.

    **3. Move spectator HUD below top-center cluster (createSpectatorHUD):**

    In `createSpectatorHUD()` (line ~768): change spectatorBar Y from `this.H * 0.07` to `this.H * 0.16`.
    In the same method (line ~777): change spectatorInstruction Y from `this.H * 0.1` to `this.H * 0.2`.
  </action>
  <verify>
    Run `cd /Users/jonasbrandvik/Projects/banger-game/client && npx tsc --noEmit` -- must exit with 0 errors.
    Grep for `ELIMINATED` in HUDScene.ts -- should find zero matches in showDeathOverlay.
    Grep for `0.07` in createSpectatorHUD -- should find zero matches (moved to 0.16).
    Grep for `fontSize: '24px'` in createMatchTimer section -- should find the new timer size.
  </verify>
  <done>
    Timer text is 24px, pips are 7px radius with 20px spacing at full alpha, stage label is 14px with white color and 3px stroke, all backed by a dark semi-transparent panel. Death overlay shows only the centered gravestone with no ELIMINATED text. Spectator label positioned at H*0.16 clear of the top-center HUD cluster. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix powerup aura colors to match potion colors</name>
  <files>client/src/systems/ParticleFactory.ts</files>
  <action>
    Correct the three aura tint colors in ParticleFactory.ts to match the established potion color mapping (Red=Speed, Blue=Invincibility, Green=Projectile per Phase 12 decisions):

    **speedAura()** (line ~185): change `tint: 0x4488ff` (blue) to `tint: 0xCC3333` (red -- matches potion_speed = red potion). Also update the JSDoc comment on line ~175 from "blue-cyan particles" to "red particles matching speed potion color".

    **invincibilityAura()** (line ~208): change `tint: 0xffcc00` (gold) to `tint: 0x4488ff` (blue -- matches potion_invincibility = blue potion). Also update the JSDoc comment on line ~196 from "gold-amber particles" to "blue particles matching invincibility potion color".

    **projectileAura()** (line ~231): change `tint: 0xff4422` (orange) to `tint: 0x44CC66` (green -- matches potion_projectile = green potion). Also update the JSDoc comment on line ~219 from "red-orange spark particles" to "green particles matching projectile potion color".

    These colors are chosen to match the design token character/status colors: 0xCC3333 = Colors.status.dangerNum (red), 0x4488ff = a medium blue, 0x44CC66 = close to Colors.char.baranNum/Colors.status.successNum (green).
  </action>
  <verify>
    Run `cd /Users/jonasbrandvik/Projects/banger-game/client && npx tsc --noEmit` -- must exit with 0 errors.
    Grep ParticleFactory.ts for `0x4488ff` -- should appear ONLY in invincibilityAura (not speedAura).
    Grep ParticleFactory.ts for `0xCC3333` -- should appear in speedAura.
    Grep ParticleFactory.ts for `0x44CC66` -- should appear in projectileAura.
    Grep ParticleFactory.ts for `0xffcc00` -- should find zero matches (removed from invincibilityAura).
    Grep ParticleFactory.ts for `0xff4422` -- should find zero matches (removed from projectileAura).
  </verify>
  <done>
    Speed aura emits red particles (0xCC3333), invincibility aura emits blue particles (0x4488ff), projectile aura emits green particles (0x44CC66) -- all matching their respective potion icon colors. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/jonasbrandvik/Projects/banger-game/client && npx tsc --noEmit` exits with 0 errors
2. No remaining `ELIMINATED` text creation in showDeathOverlay
3. Spectator HUD Y positions are >= H*0.15 (no overlap with top-center cluster)
4. Timer fontSize is 24px, pip radius is 7, stage label is 14px
5. ParticleFactory aura colors: speed=0xCC3333 (red), invincibility=0x4488ff (blue), projectile=0x44CC66 (green)
6. Dark backdrop panel exists behind top-center HUD cluster
</verification>

<success_criteria>
All 4 UAT gaps resolved: top-center HUD elements are clearly readable with dark backdrop and larger sizes, death overlay shows only gravestone without redundant text, aura particle colors match potion colors, spectator label sits below the top-center cluster with no overlap. TypeScript compiles with zero errors.
</success_criteria>

<output>
After completion, create `.planning/phases/12-hud-icon-overhaul/12-03-SUMMARY.md`
</output>
