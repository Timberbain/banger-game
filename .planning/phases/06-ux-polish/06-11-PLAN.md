---
phase: 06-ux-polish
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/scenes/GameScene.ts
  - client/src/systems/Prediction.ts
  - client/src/systems/ParticleFactory.ts
  - client/src/config/SoundDefs.ts
  - client/src/scenes/HUDScene.ts
  - client/src/config/SoundDefs.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Shooting sound only plays when projectile is actually fired (not during cooldown)"
    - "Role banner visible without being overlapped by FIGHT! text at match start"
    - "Spectator HUD at top of screen below timer, not covering health bars"
    - "Paran speed lines clearly visible and impactful at high velocity"
    - "All characters produce audible shoot sounds for all players (including guardians)"
    - "Wall impact sound/effect only plays once on initial collision (not when holding against wall)"
    - "Back to lobby button plays audible click sound"
    - "Speed whoosh sound completely removed from game"
  artifacts:
    - path: "client/src/scenes/GameScene.ts"
      provides: "Cooldown-gated shoot sound, guardian shoot sound in createProjectileSprite, speed whoosh removal"
      min_lines: 1000
    - path: "client/src/systems/Prediction.ts"
      provides: "Rising-edge collision detection with wasAgainstWall flag"
      min_lines: 150
    - path: "client/src/systems/ParticleFactory.ts"
      provides: "Enhanced speed line particles (0.8 scale, 0.7 alpha, 250ms lifespan, gold tint)"
      min_lines: 150
    - path: "client/src/config/SoundDefs.ts"
      provides: "Amplified button_click sound, speed_whoosh removal"
      min_lines: 300
    - path: "client/src/scenes/HUDScene.ts"
      provides: "Non-overlapping role banner/FIGHT! positions, spectator HUD at top"
      min_lines: 700
  key_links:
    - from: "client/src/scenes/GameScene.ts"
      to: "cooldown check block"
      via: "playSFX inside if (now - lastLocalFireTime >= cooldownMs)"
      pattern: "if.*lastLocalFireTime.*playSFX"
    - from: "client/src/systems/Prediction.ts"
      to: "wasAgainstWall boolean"
      via: "rising-edge detector for hadCollision"
      pattern: "wasAgainstWall.*hadCollision.*true"
    - from: "client/src/scenes/GameScene.ts"
      to: "createProjectileSprite"
      via: "playSFX for guardian shoot sound"
      pattern: "createProjectileSprite.*playSFX.*shoot"
    - from: "client/src/scenes/HUDScene.ts"
      to: "roleBanner Y position"
      via: "Y=200 instead of Y=280"
      pattern: "roleBanner.*200"
    - from: "client/src/scenes/HUDScene.ts"
      to: "spectatorBar Y position"
      via: "Y=50 instead of Y=540"
      pattern: "spectatorBar.*50"
---

<objective>
Commit debug agent fixes and apply remaining UAT gap closures for Phase 6 UX Polish.

Purpose: Complete all UAT issues (tests 6, 8, 9, 14, 16, 17, 18, 25) by committing already-applied debug fixes and implementing final HUD positioning and sound volume adjustments.

Output: All 8 UAT issues resolved, uncommitted changes committed, Phase 6 complete.
</objective>

<execution_context>
@/Users/jonasbrandvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jonasbrandvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ux-polish/06-UAT.md
@.planning/phases/06-ux-polish/06-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Commit debug agent fixes for tests 6, 14, 17, 25</name>
  <files>
    client/src/scenes/GameScene.ts
    client/src/systems/Prediction.ts
    client/src/systems/ParticleFactory.ts
    client/src/config/SoundDefs.ts
  </files>
  <action>
Commit the already-applied debug agent fixes for UAT issues:

**Test 6 (shoot sound on cooldown):** GameScene.ts - shoot SFX moved inside cooldown-gated block (lines 462-466)
**Test 14 (speed lines too subtle):** ParticleFactory.ts - increased scale to 0.8, alpha to 0.7, lifespan to 250ms, 5 particles with gold tint (lines 134-145)
**Test 17 (wall impact spam):** Prediction.ts - added wasAgainstWall rising-edge detector (lines 32-33, 84-100, 151-163); GameScene.ts - removed speed whoosh trigger and lastWhooshTime field (lines 83, 135, 490-495)
**Test 25 (wall impact repeat):** Same fix as test 17 (rising-edge detector)
**Speed whoosh removal:** SoundDefs.ts - removed speed_whoosh sound definition entirely (lines 214-227, 303)

Create commit with message: "fix(06): UAT gap closure - shoot sound, speed lines, wall impact spam, speed whoosh removal"

Add files to commit:
- client/src/scenes/GameScene.ts
- client/src/systems/Prediction.ts
- client/src/systems/ParticleFactory.ts
- client/src/config/SoundDefs.ts
  </action>
  <verify>
git log --oneline -1 shows the commit
git diff shows no changes to these 4 files (all committed)
  </verify>
  <done>
Debug agent fixes for tests 6, 14, 17, 25 committed to git
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix remaining UAT issues (8, 9, 16, 18)</name>
  <files>
    client/src/scenes/HUDScene.ts
    client/src/scenes/GameScene.ts
    client/src/config/SoundDefs.ts
  </files>
  <action>
Apply final fixes for remaining UAT issues:

**Test 8 (role banner overlapped by FIGHT! text):**
- File: client/src/scenes/HUDScene.ts
- Line 561: Change roleBanner Y position from 280 to 200
  ```typescript
  this.roleBanner = this.add.text(400, 200, `YOU ARE ${roleName}`, {
  ```
- This moves banner 80px higher, well above FIGHT! at Y=300

**Test 9 (spectator HUD covers health bars):**
- File: client/src/scenes/HUDScene.ts
- Line 602: Change spectatorBar Y position from 540 to 50
- Line 615: Change spectatorInstruction Y position from 565 to 75
  ```typescript
  this.spectatorBar = this.add.text(400, 50, '', {
  // ...
  this.spectatorInstruction = this.add.text(400, 75, 'Press TAB to cycle', {
  ```
- This moves spectator HUD to top below timer, away from health bars at Y=557-583

**Test 16 (guardian shoot sounds missing):**
- File: client/src/scenes/GameScene.ts
- In createProjectileSprite method (line 698), after line 707 (after determining frameIndex), add:
  ```typescript
  // Play shoot sound for remote projectiles (local player already plays via input handler)
  if (this.audioManager && this.room && projectile.ownerId !== this.localSessionId) {
    const ownerPlayer = this.room.state.players.get(projectile.ownerId);
    if (ownerPlayer && ownerPlayer.role) {
      this.audioManager.playSFX(`${ownerPlayer.role}_shoot`);
    }
  }
  ```
- This plays the owner's role-specific shoot sound for all remote projectiles (skip local to avoid double-play with input handler)

**Test 18 (back to lobby button sound too quiet):**
- File: client/src/config/SoundDefs.ts
- Line 233 (button_click definition): Increase sound_vol from 0.15 to 0.35
  ```typescript
  sound_vol: 0.35,
  ```
- This more than doubles the button click volume for better audibility

After all changes, commit with message: "fix(06): UAT gap closure - HUD positions, guardian shoot sound, button click volume"
  </action>
  <verify>
Verification steps:
1. Read HUDScene.ts and confirm roleBanner Y=200, spectatorBar Y=50, spectatorInstruction Y=75
2. Read GameScene.ts createProjectileSprite and confirm playSFX call for remote projectiles exists
3. Read SoundDefs.ts and confirm button_click sound_vol=0.35
4. Run `git log --oneline -1` and verify commit message
5. Run `git diff` and confirm no uncommitted changes
  </verify>
  <done>
All 8 UAT issues resolved:
- Test 6: Shoot sound respects cooldown ✓ (committed)
- Test 8: Role banner at Y=200, no overlap ✓
- Test 9: Spectator HUD at top (Y=50-75) ✓
- Test 14: Speed lines enhanced ✓ (committed)
- Test 16: Guardian shoot sounds audible ✓
- Test 17: Wall impact rising-edge only ✓ (committed)
- Test 18: Button click volume amplified ✓
- Test 25: Wall impact rising-edge only ✓ (committed)
  </done>
</task>

</tasks>

<verification>
## Overall Verification

All UAT gaps from 06-UAT.md should be resolved:

1. **Test 6:** Shoot sound only plays when projectile fired (not during cooldown)
2. **Test 8:** Role banner visible at Y=200, FIGHT! at Y=300 with no overlap
3. **Test 9:** Spectator HUD at top (Y=50-75) below timer, not covering health bars (Y=557-583)
4. **Test 14:** Speed lines clearly visible (scale 0.8, alpha 0.7, gold tint)
5. **Test 16:** Guardian shoot sounds audible for all players via createProjectileSprite
6. **Test 17:** Wall impact only on rising edge (wasAgainstWall detector)
7. **Test 18:** Button click audible (sound_vol 0.35)
8. **Test 25:** Same fix as test 17

Run `npm run dev` in both client and server directories and manually verify:
- Start a match (3 players)
- Guardian shooting produces sound for all players
- Paran hits wall only once (not spam while holding against it)
- Speed lines clearly visible when Paran moves fast
- Role banner appears at match start without FIGHT! overlap
- Eliminated player sees spectator HUD at top
- Return to lobby button plays audible click

All changes committed to git with appropriate messages.
</verification>

<success_criteria>
Phase 6 UAT gap closure complete when:
- [ ] All 8 UAT issues have fixes applied
- [ ] Debug agent fixes (tests 6, 14, 17, 25) committed
- [ ] Remaining fixes (tests 8, 9, 16, 18) committed
- [ ] No uncommitted changes in client/src/
- [ ] Git log shows 2 commits for gap closure
- [ ] All 25 UAT tests would pass if re-run
</success_criteria>

<output>
After completion, create `.planning/phases/06-ux-polish/06-11-SUMMARY.md` documenting:
- Which gaps were closed
- What changes were made (commit references)
- Final UAT status (8 issues resolved)
</output>
