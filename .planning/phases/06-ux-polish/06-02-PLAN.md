---
phase: 06-ux-polish
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - client/public/sprites/paran.png
  - client/public/sprites/faran.png
  - client/public/sprites/baran.png
  - client/public/sprites/projectiles.png
  - client/public/sprites/particle.png
  - client/public/tilesets/solarpunk_ruins.png
  - client/public/tilesets/solarpunk_living.png
  - client/public/tilesets/solarpunk_tech.png
  - client/public/tilesets/solarpunk_mixed.png
  - client/public/maps/test_arena.json
  - client/public/maps/corridor_chaos.json
  - client/public/maps/cross_fire.json
  - client/public/maps/pillars.json
  - client/src/scenes/BootScene.ts
  - client/src/scenes/GameScene.ts
autonomous: true

must_haves:
  truths:
    - "Players render as animated pixel art sprites instead of colored rectangles"
    - "Each role has a visually distinct sprite with unique silhouette"
    - "Projectiles render as role-specific pixel art shapes instead of circles"
    - "Tilesets show solarpunk-themed walls and floors instead of solid colors"
    - "Each of the 4 maps has its own unique tileset style"
    - "Floating health bars and name labels above characters are removed"
    - "Walk animations play based on movement direction"
  artifacts:
    - path: "client/public/sprites/paran.png"
      provides: "Paran character spritesheet (32x32 frames, walk/idle/shoot/death)"
    - path: "client/public/sprites/faran.png"
      provides: "Faran character spritesheet"
    - path: "client/public/sprites/baran.png"
      provides: "Baran character spritesheet"
    - path: "client/public/sprites/projectiles.png"
      provides: "Projectile sprites per role"
    - path: "client/public/sprites/particle.png"
      provides: "Small white particle texture for tinting at runtime"
    - path: "client/src/scenes/GameScene.ts"
      provides: "Sprite-based player and projectile rendering with animations"
      contains: "Phaser.GameObjects.Sprite"
    - path: "client/src/scenes/BootScene.ts"
      provides: "Preloading of all sprite assets and tileset images"
      contains: "this.load.spritesheet"
  key_links:
    - from: "client/src/scenes/BootScene.ts"
      to: "client/public/sprites/"
      via: "this.load.spritesheet()"
      pattern: "load\\.spritesheet"
    - from: "client/src/scenes/GameScene.ts"
      to: "Phaser AnimationManager"
      via: "sprite.play() for walk/idle/shoot/death"
      pattern: "sprite\\.play"
---

<objective>
Create all pixel art assets (character spritesheets, tilesets, projectile sprites, particle texture) and integrate them into the game, replacing all placeholder rectangles, circles, and solid-color tiles.

Purpose: Transforms the game from developer placeholders to actual pixel art with a solarpunk aesthetic. This is the visual foundation that all other polish (particles, HUD, effects) builds upon.

Output: 3 character spritesheets with animations, 4 per-map tilesets, projectile sprites, particle texture, and updated GameScene rendering.
</objective>

<execution_context>
@/Users/jonasbrandvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jonasbrandvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ux-polish/06-RESEARCH.md
@.planning/phases/06-ux-polish/06-01-SUMMARY.md
@client/src/scenes/BootScene.ts
@client/src/scenes/GameScene.ts
@shared/characters.ts
@shared/obstacles.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate pixel art assets (spritesheets, tilesets, particles)</name>
  <files>
    client/public/sprites/paran.png
    client/public/sprites/faran.png
    client/public/sprites/baran.png
    client/public/sprites/projectiles.png
    client/public/sprites/particle.png
    client/public/tilesets/solarpunk_ruins.png
    client/public/tilesets/solarpunk_living.png
    client/public/tilesets/solarpunk_tech.png
    client/public/tilesets/solarpunk_mixed.png
    scripts/generate-assets.ts
  </files>
  <action>
    Create a Node.js script `scripts/generate-assets.ts` that programmatically generates all pixel art assets using the `canvas` package (already installed for tileset generation in Phase 1). Run the script to produce all PNG files.

    **Asset creation approach (Claude's discretion):** Programmatic pixel art using canvas drawing primitives. This is the most practical approach because: (a) Claude cannot use AI art generators interactively, (b) canvas is already a dependency, (c) 32x32 pixel art can be drawn programmatically with filled rectangles and circles.

    **Color palette (from user decision):** Warm greens + gold solarpunk.
    - Paran: deep red (#cc3333) with golden accents (#d4a746), larger angular body (32x32 sprite with 28-30px character)
    - Faran: blue (#4488ff) with teal accents (#44bbaa), sleek slim body (32x32 sprite with 20-22px character)
    - Baran: green (#44cc66) with bronze accents (#8b6d3c), stocky heavy body (32x32 sprite with 22-24px character)

    **Character spritesheets (3 files, each 192x192 or similar):**
    Per character, generate a spritesheet with 32x32 frames in this layout:
    ```
    Row 0 (frames 0-3):   Walk Down (4 frames)
    Row 1 (frames 4-7):   Walk Up (4 frames)
    Row 2 (frames 8-11):  Walk Right (4 frames)
    Row 3 (frames 12-15): Walk Left (4 frames, mirrored)
    Row 4 (frames 16-17): Idle (2 frames)
    Row 5 (frames 18-19): Shoot (2 frames)
    Row 6 (frames 20-25): Death (6 frames)
    ```
    Total: 26 frames per character. Sheet = 6 columns x 5 rows (with last row having 6 frames) = 192x160 pixels.
    Actually simplify: lay out as a flat strip of 26 frames in a single row (26 * 32 = 832 x 32 pixels). Phaser's spritesheet loader handles flat strips fine.

    Each character MUST have a distinct silhouette at 32x32 per user decision:
    - Paran: Large angular/triangular shape (like a wedge/tank, emphasizing momentum). Red body with golden highlight.
    - Faran: Slim vertical rectangle with pointed top (like an agile archer). Blue body with teal trim.
    - Baran: Wide squat rectangle (like a shield bearer). Green body with bronze edges.

    Walk animation: shift legs/lower pixels between frames (2-pixel oscillation).
    Idle: subtle breathing (body shifts 1px up/down between 2 frames).
    Shoot: brief flash/extension in facing direction.
    Death: body fragments/fades out over 6 frames.

    **Projectile spritesheet (1 file, 3 sprites in a row):**
    - 8x8 pixels per projectile frame, 3 frames total (24x8 pixels)
    - Frame 0 (Paran): bright gold energy blast (diamond/star shape)
    - Frame 1 (Faran): blue dart (thin elongated shape)
    - Frame 2 (Baran): green bolt (small square with trail marks)

    **Particle texture (1 file):**
    - Simple 8x8 white filled circle with transparent background
    - Will be tinted at runtime for different colors

    **Tilesets (4 files, one per map):**
    CRITICAL: Each tileset must maintain tile ID compatibility. Tile IDs 1-6 map to: 1=floor/empty, 2=ground, 3=wall, 4=heavy obstacle, 5=medium obstacle, 6=light obstacle. The tileset image layout must match the existing `placeholder.png` layout (128x64, 8 tiles in a 4x2 grid, each 32x32). Actually the placeholder is 8 tiles in a row (256x32) or grid -- check the actual layout. Each new tileset replaces the corresponding tile graphics:

    - `solarpunk_ruins.png` (test_arena): Overgrown stone ruins. Floor=weathered stone with moss. Walls=crumbling stone blocks with vines. Obstacles=partially collapsed pillars (heavy=dark stone, medium=cracked stone, light=rubble).
    - `solarpunk_living.png` (corridor_chaos): Living walls/hedges. Floor=grass/dirt paths. Walls=thick hedgerows/tree trunks. Obstacles=wooden barricades (heavy=thick logs, medium=woven branches, light=thin saplings).
    - `solarpunk_tech.png` (cross_fire): Tech+nature blend. Floor=solar panel walkways. Walls=bio-luminescent crystal formations. Obstacles=grow pods (heavy=full crystal, medium=cracked pod, light=seed pod).
    - `solarpunk_mixed.png` (pillars): Mixed aesthetic. Floor=cobblestone with grass patches. Walls=brick+vine hybrid. Obstacles=overgrown machinery (heavy=generator, medium=console, light=crate).

    **Update map JSON files** to reference the per-map tilesets:
    - test_arena.json: change tileset image reference from `../tilesets/placeholder.png` to `../tilesets/solarpunk_ruins.png`
    - corridor_chaos.json: reference `../tilesets/solarpunk_living.png`
    - cross_fire.json: reference `../tilesets/solarpunk_tech.png`
    - pillars.json: reference `../tilesets/solarpunk_mixed.png`

    Create output directories `client/public/sprites/` before generating files.
  </action>
  <verify>
    Verify all PNG files exist:
    - `ls client/public/sprites/paran.png client/public/sprites/faran.png client/public/sprites/baran.png client/public/sprites/projectiles.png client/public/sprites/particle.png`
    - `ls client/public/tilesets/solarpunk_ruins.png client/public/tilesets/solarpunk_living.png client/public/tilesets/solarpunk_tech.png client/public/tilesets/solarpunk_mixed.png`
    Verify map JSON tileset references updated.
  </verify>
  <done>
    All pixel art assets generated: 3 character spritesheets with distinct silhouettes, 4 per-map solarpunk tilesets, projectile sprites per role, and particle texture. Map JSONs reference their respective tilesets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate sprites into BootScene and GameScene</name>
  <files>
    client/src/scenes/BootScene.ts
    client/src/scenes/GameScene.ts
  </files>
  <action>
    **BootScene.ts -- preload all assets:**
    1. Load character spritesheets:
       ```
       this.load.spritesheet('paran', 'sprites/paran.png', { frameWidth: 32, frameHeight: 32 });
       this.load.spritesheet('faran', 'sprites/faran.png', { frameWidth: 32, frameHeight: 32 });
       this.load.spritesheet('baran', 'sprites/baran.png', { frameWidth: 32, frameHeight: 32 });
       ```
    2. Load projectile spritesheet:
       ```
       this.load.spritesheet('projectiles', 'sprites/projectiles.png', { frameWidth: 8, frameHeight: 8 });
       ```
    3. Load particle texture:
       ```
       this.load.image('particle', 'sprites/particle.png');
       ```
    4. Remove the old `this.load.image('tiles', 'tilesets/placeholder.png')` line -- tiles now loaded per-map in GameScene.
    5. Create all animations in BootScene.create() for each character (paran, faran, baran):
       - `{role}-walk-down`: frames 0-3, frameRate 8, repeat -1
       - `{role}-walk-up`: frames 4-7, frameRate 8, repeat -1
       - `{role}-walk-right`: frames 8-11, frameRate 8, repeat -1
       - `{role}-walk-left`: frames 12-15, frameRate 8, repeat -1
       - `{role}-idle`: frames 16-17, frameRate 4, repeat -1
       - `{role}-shoot`: frames 18-19, frameRate 10, repeat 0
       - `{role}-death`: frames 20-25, frameRate 10, repeat 0

    **GameScene.ts -- replace rectangles with sprites:**
    1. Change `playerSprites` type from `Map<string, Phaser.GameObjects.Rectangle>` to `Map<string, Phaser.GameObjects.Sprite>`.
    2. In the `players.onAdd` handler:
       - Replace `this.add.rectangle(player.x, player.y, size, size, color)` with `this.add.sprite(player.x, player.y, role)`.
       - Set the sprite depth to 10.
       - Play the idle animation: `sprite.play(`${role}-idle`)`.
       - Store as Sprite in playerSprites map.
    3. **REMOVE floating health bars** per user decision (no health bars above characters):
       - Remove the `this.add.graphics()` health bar creation.
       - Remove the `healthBars` Map entirely.
       - Remove `updateHealthBar()` and `drawHealthBar()` methods.
       - Remove health bar position updates in the `update()` loop.
    4. **REMOVE player name labels** per user decision (nothing above characters):
       - Remove the `this.add.text()` name label creation.
       - Remove the `playerLabels` Map entirely.
       - Remove label position updates in the `update()` loop.
    5. In `update()`, determine facing direction from velocity and play appropriate walk animation:
       - If `Math.abs(vx) > 0.1 || Math.abs(vy) > 0.1`: pick direction based on dominant velocity axis.
         - `vx > 0`: play `{role}-walk-right`
         - `vx < 0`: play `{role}-walk-left`
         - `vy > 0 (and abs(vy) > abs(vx))`: play `{role}-walk-down`
         - `vy < 0 (and abs(vy) > abs(vx))`: play `{role}-walk-up`
       - If velocity near zero: play `{role}-idle`
       - Only call `sprite.play()` if animation key differs from current (avoid restart).
    6. Apply same animation logic for remote players (use interpolated velocity or position delta).
    7. **Replace projectile circles with sprites:**
       - Change `projectileSprites` type from `Map<number, Phaser.GameObjects.Arc>` to `Map<number, Phaser.GameObjects.Sprite>`.
       - Map projectile owner's role to frame index: paran=0, faran=1, baran=2.
       - Replace `this.add.circle(...)` with `this.add.sprite(x, y, 'projectiles', frameIndex)`.
    8. Update the `handlePlayerChange()` method: remove Rectangle-specific calls (`setSize`, `setFillStyle`). Sprite appearance is set by the animation, not by fill style.
    9. In `createTilemap()`, update tileset loading: instead of always loading 'placeholder.png', load the map-specific tileset. The map JSON already references the correct tileset PNG (updated in Task 1). Load the correct tileset image key based on map name:
       - test_arena -> 'solarpunk_ruins'
       - corridor_chaos -> 'solarpunk_living'
       - cross_fire -> 'solarpunk_tech'
       - pillars -> 'solarpunk_mixed'
       Load the tileset image in the dynamic load block (after receiving mapName from server).
    10. In `attachRoomListeners()`, apply the same sprite replacement logic for reconnection.
    11. For death animation: when player health reaches 0, play `{role}-death` animation (non-looping), and on animation complete, set alpha to 0.3.
  </action>
  <verify>
    Run `cd /Users/jonasbrandvik/Projects/banger-game/client && npx tsc --noEmit` to verify TypeScript compiles.
    Verify no references to `Phaser.GameObjects.Rectangle` remain for player sprites.
    Verify no references to floating health bars or name labels remain.
    Verify spritesheet loading exists in BootScene.
  </verify>
  <done>
    Players render as animated pixel art sprites with walk/idle/shoot/death animations. Projectiles render as role-specific sprites. Tilesets show per-map solarpunk art. No floating health bars or name labels above characters (per user decision). All placeholder rectangles and circles are replaced.
  </done>
</task>

</tasks>

<verification>
1. Client compiles without errors
2. All 9 PNG assets exist in client/public/sprites/ and client/public/tilesets/
3. No Phaser.GameObjects.Rectangle for player sprites in GameScene
4. No floating health bars (healthBars Map removed)
5. No floating name labels (playerLabels Map removed)
6. Animations created for all 3 characters (walk-down/up/left/right, idle, shoot, death)
7. Map JSONs reference per-map tileset PNGs
8. Projectiles use sprite frames instead of circles
</verification>

<success_criteria>
Game renders with pixel art sprites for all characters, role-specific projectiles, and per-map solarpunk tilesets. Walk animations play based on movement direction. Death animations play on elimination. No floating UI elements above characters.
</success_criteria>

<output>
After completion, create `.planning/phases/06-ux-polish/06-02-SUMMARY.md`
</output>
